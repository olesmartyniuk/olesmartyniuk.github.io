<!DOCTYPE html>



<html lang="uk" 
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  
    <meta name="pv-cache-enabled" content="false">

    
  

  <title>
      Зустрічайте C# 9.0 | 
    Мартинюк Олександр
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://www.favicon-generator.org/
-->



<link rel="shortcut icon" href="/uk/assets/img/favicons/favicon.ico" type="image/x-icon">
<link rel="icon" href="/uk/assets/img/favicons/favicon.ico" type="image/x-icon">

<link rel="apple-touch-icon" href="/uk/assets/img/favicons/apple-icon.png">
<link rel="apple-touch-icon" href="/uk/assets/img/favicons/apple-icon-precomposed.png">
<link rel="apple-touch-icon" sizes="57x57" href="/uk/assets/img/favicons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/uk/assets/img/favicons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/uk/assets/img/favicons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/uk/assets/img/favicons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/uk/assets/img/favicons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/uk/assets/img/favicons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/uk/assets/img/favicons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/uk/assets/img/favicons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/uk/assets/img/favicons/apple-icon-180x180.png">

<link rel="icon" type="image/png" sizes="192x192"  href="/uk/assets/img/favicons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/uk/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/uk/assets/img/favicons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/uk/assets/img/favicons/favicon-16x16.png">

<link rel="manifest" href="/uk/assets/img/favicons/manifest.json">
<meta name='msapplication-config' content='/uk/assets/img/favicons/browserconfig.xml'>
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/uk/assets/img/favicons/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous">

  <!-- Font Awesome -->
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"
    integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ="
    crossorigin="anonymous">

  <!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css">


  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">



  <!-- JavaScripts -->

  <script src="/assets/js/dist/lang-detector.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  <script defer
    src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>

  <!--
  JS selector for site.
-->


  





<script defer src="/assets/js/dist/post.min.js"></script>






</head>


  <body data-spy="scroll" data-target="#toc">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">

  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        
        <img src="/assets/img/sample/avatar.jpg" alt="avatar" onerror="this.style.display='none'">
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">Мартинюк Олександр</a>
    </div>

    <div class="site-subtitle font-italic">Програміст .NET</div>

    <!-- language -->

    
    
    <div class="site-title mt-0">               
      
        <a href="/posts/%D0%B7%D1%83%D1%81%D1%82%D1%80%D1%96%D1%87%D0%B0%D0%B9%D1%82%D0%B5-csharp-9/" title="In English">
          <img src="/assets/img/sample/english.png" width="40px" height="40px"/>          
        </a>  
                    
    </div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">    
    <!-- home -->
    
    <li class="nav-item">
      <a href="/uk/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>СТАТТІ</span>
      </a>
    </li>
    <!-- the real tabs -->
    

      

      <li class="nav-item">
        <a href="/uk/categories/" class="nav-link">
          <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
          <span>КАТЕГОРІЇ</span>
        </a>
      </li> <!-- .nav-item -->
    

      

      <li class="nav-item">
        <a href="/uk/tags/" class="nav-link">
          <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i>
          <span>ТЕГИ</span>
        </a>
      </li> <!-- .nav-item -->
    

      

      <li class="nav-item">
        <a href="/uk/archives/" class="nav-link">
          <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
          <span>АРХІВ</span>
        </a>
      </li> <!-- .nav-item -->
    

      

      <li class="nav-item">
        <a href="/uk/projects/" class="nav-link">
          <i class="fa-fw fas fa-tasks ml-xl-3 mr-xl-3 unloaded"></i>
          <span>ПРОЄКТИ</span>
        </a>
      </li> <!-- .nav-item -->
    

      

      <li class="nav-item">
        <a href="/uk/about/" class="nav-link">
          <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i>
          <span>ПРО МЕНЕ</span>
        </a>
      </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">

    
      

      
      <a href="https://github.com/alexmartyniuk" aria-label="github"
        class="order-3"
        target="_blank" rel="noopener">
        <i class="fab fa-github-alt"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/alexmartyniuk" aria-label="twitter"
        class="order-4"
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['alexander.martinyuk','gmail.com'].join('@')" aria-label="email"
        class="order-5"
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        class="order-6"
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

    
      
        <span class="icon-border order-2"></span>
      

      <span id="mode-toggle-wrapper" class="order-1">
        <!--
  Switch the mode between dark and light.
-->

<i class="mode-toggle fas fa-adjust"></i>

<script type="text/javascript">

  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      var self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addListener(function() {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }

          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.updateMermaid();
      });

    } /* constructor() */


    setDark() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_KEY);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; }

    get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer) ) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    updateMermaid() {
      if (typeof mermaid !== "undefined") {
        let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default");
        let config = { theme: expectedTheme };

        /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */
        $(".mermaid").each(function() {
          let svgCode = $(this).prev().children().html();
          $(this).removeAttr("data-processed");
          $(this).html(svgCode);
        });

        mermaid.initialize(config);
        mermaid.init(undefined, ".mermaid");
      }
    }

    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }

        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }

      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.updateMermaid();

    } /* flipMode() */

  } /* ModeToggle */

  let toggle = new ModeToggle();

  $(".mode-toggle").click(function() {

    toggle.flipMode();

  });

</script>

      </span>
    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">

    

    

      

        
          

        

      

        
        <span>
          
          
          <a href="/">
            Posts
          </a>
        </span>

        

      

        
          <span></span>

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->


<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->


<!-- Add attribute 'hide-bullet' to the checkbox list -->




  

  

  <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->
  
  

  

  



<!-- return -->
<div class="row">

  <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">

    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

      <h1 data-toc-skip>Зустрічайте C# 9.0</h1>

      <div class="post-meta text-muted d-flex flex-column">
        <!-- Published date and author -->
        <div>
          <!--
  Date format snippet
-->





<span class="timeago "
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Thu, Jun 11, 2020,  1:00 PM +0300"
  >

  
  

  
    Jun 11, 2020
  

  <i class="unloaded">2020-06-11T13:00:00+03:00</i>

</span>
          
        </div>

        <div>       
          <!-- read time -->
          <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->


<!-- words per minute  -->







<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2433 words">13 min</span>


          <!-- page views -->
          

        </div>

      </div> <!-- .post-meta -->

      <div class="post-content">

        

        <p>Це переклад статті <a href="https://devblogs.microsoft.com/dotnet/welcome-to-c-9-0/">“Welcome to C# 9.0”</a> Медса Тоерсена - працівника Microsoft і головного дизайнера мови C#.</p>

<hr />
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="http://www.martyniuk.info/assets/img/posts/2020-06-11-welcome-to-csharp-9\cover.jpg" alt="" /></p>

<p>C# 9.0 набуває форм і я хочу поділитись нашим баченням найбільш важливих можливостей, які ми додаємо в наступну версію мови.</p>

<p>З кожною новою версією ми прагнемо зробити мову більш ясною і простою для загальних сценаріїв використання і C# 9.0 не є винятком. Цього разу нашим фокусом є забезпечення лаконічності в представленні даних та підтримка механізмів їх незмінності.</p>

<p>Ну що ж, поїхали!</p>

<h2 id="властивості-з-ініціалізацією">Властивості з ініціалізацією</h2>

<p>Ініціалізатори об’єктів надзвичайно корисні: вони дають програмісту дуже гнучку і, водночас, зрозумілу форму створення об’єктів. Вони особливо зручні для створення вкладених об’єктів, коли ціла ієрархія створюється однією командою. Ось приклад:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">new</span> <span class="n">Person</span>
<span class="p">{</span>
    <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"Scott"</span><span class="p">,</span>
    <span class="n">LastName</span> <span class="p">=</span> <span class="s">"Hunter"</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Ініціалізатори об’єктів також звільняють автора класу від написання шаблонного коду конструкторів. Все, що потрібно, - лише створити певні властивості!</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">Person</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Проте сьогодні є одне велике обмеження: щоб ініціалізатори працювали, властивості повинні бути <em>змінюваними</em> (mutable). Ініціалізатори працюють завдяки виклику конструктора (без параметрів в даному випадку) і наступному присвоєнню значень через виклик сетерів властивостей.</p>

<p>Властивості з ініціалізацією виправлять це! Вони визначають <code class="language-plaintext highlighter-rouge">init</code> аксесор який дуже схожий на <code class="language-plaintext highlighter-rouge">set</code> аксесор, але може викликатись лише під час ініціалізації об’єкту:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">Person</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="n">init</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="n">init</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>З таким підходом код, написаний вище, все ще коректний, але всі наступні присвоєння значень властивостям <code class="language-plaintext highlighter-rouge">FirstName</code> і <code class="language-plaintext highlighter-rouge">LastName</code> викличуть помилку.</p>

<h3 id="init-аксесори-та-поля-лише-для-читання">Init аксесори та поля лише для читання</h3>

<p>Так як <code class="language-plaintext highlighter-rouge">init</code> аксесори можуть викликатись лише під час ініціалізації, їм дозволено змінювати поля для читання того ж класу, точно так, як ви зараз можете зробити це у конструкторі.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">Person</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="kt">string</span> <span class="n">firstName</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="kt">string</span> <span class="n">lastName</span><span class="p">;</span>
    
    <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> 
    <span class="p">{</span> 
        <span class="k">get</span> <span class="p">=&gt;</span> <span class="n">firstName</span><span class="p">;</span> 
        <span class="n">init</span> <span class="p">=&gt;</span> <span class="n">firstName</span> <span class="p">=</span> <span class="p">(</span><span class="k">value</span> <span class="p">??</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentNullException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">FirstName</span><span class="p">)));</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> 
    <span class="p">{</span> 
        <span class="k">get</span> <span class="p">=&gt;</span> <span class="n">lastName</span><span class="p">;</span> 
        <span class="n">init</span> <span class="p">=&gt;</span> <span class="n">lastName</span> <span class="p">=</span> <span class="p">(</span><span class="k">value</span> <span class="p">??</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentNullException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">LastName</span><span class="p">)));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="класи-даних-record">Класи даних (record)</h2>

<p>Властивості з ініціалізацією чудово підходять, якщо ви хочете зробити певну властивість об’єкту незмінною. Якщо ж ви хочете зробити незмінним весь об’єкт, щоб він поводив себе як екземпляр типу-значення, вам необхідно визначити його як <em>клас даних</em> (record):</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="n">data</span> <span class="k">class</span> <span class="nc">Person</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="n">init</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="n">init</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Ключове слово <code class="language-plaintext highlighter-rouge">data</code> у визначенні позначає його як клас даних. Це додає йому певної поведінки характерної для типу-значення, яку ми розглянемо далі. Загалом, класи даних краще розглядати як “значення” (дані), а не як об’єкти. Вони не створені, щоб мати змінюваний стан. Натомість, ви виражаєте зміни у часі, створюючи нові екземпляри класу даних, що відображують новий стан. Класи даних визначаються не унікальністю посилання, а тотожністю вмісту.</p>

<h3 id="вираз-with">Вираз <code class="language-plaintext highlighter-rouge">with</code></h3>
<p>При роботі з незмінними даними, загальний підхід полягає у створенні копії для відображення нового стану об’єкту. Для прикладу, якщо наша особа захоче змінити своє прізвище, ми реалізуємо це через створення нового об’єкту, що буде копією старого окрім зміненого прізвища. Цю техніку часто називають <em>неруйнівною мутацією</em>. Замість того, щоб змінювати особу <em>з часом</em> клас даних відображує стан особи в <em>конкретний момент часу</em>.</p>

<p>Щоб програмувати в такому стилі було легше, класи даних підтримують новий тип виразу - <code class="language-plaintext highlighter-rouge">with</code>:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="kt">var</span> <span class="n">otherPerson</span> <span class="p">=</span> <span class="n">person</span> <span class="n">with</span> <span class="p">{</span> <span class="n">LastName</span> <span class="p">=</span> <span class="s">"Hanselman"</span> <span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<p>With-вирази використовують синтаксис ініціалізаторів, щоб визначити, чим будуть відрізнятись новий і старий об’єкти. Ви можете задати відразу декілька властивостей.</p>

<p>Клас даних неявно включає захищений “конструктор копіювання” - це конструктор, який бере об’єкт класу даних, що існує, і копіює його поля одне за одним в новий об’єкт:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">protected</span> <span class="nf">Person</span><span class="p">(</span><span class="n">Person</span> <span class="n">original</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* копіює всі поля */</span> <span class="p">}</span> <span class="c1">// автозгенерований</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Вираз <code class="language-plaintext highlighter-rouge">with</code> викликає конструктор копіювання і потім застосовує ініціалізатор для перевизначених властивостей, але вже до проініціалізованих раніше даних.</p>

<p>Якщо вас не влаштовує згенерований конструктор копіювання, ви можете визначити свій власний і він так само буде використовуватись виразом <code class="language-plaintext highlighter-rouge">with</code>.</p>

<h3 id="порівняння-за-значенням">Порівняння за значенням</h3>
<p>Всі об’єкти наслідують віртуальний метод <code class="language-plaintext highlighter-rouge">Equals(object)</code> від класу <code class="language-plaintext highlighter-rouge">object</code>. Він використовується статичним методом <code class="language-plaintext highlighter-rouge">Object.Equals(object, object)</code> коли обидва параметри не дорівнюють <code class="language-plaintext highlighter-rouge">null</code>.</p>

<p>Структури перевизначають його, щоб отримати “порівняння за значенням”. Це коли поля структури порівнюються рекурсивно через виклик <code class="language-plaintext highlighter-rouge">Equals</code>. Класи даних роблять так само.</p>

<p>Це означає те, що згідно з їхньою “значеністю”, два об’єкти класу даних можуть бути рівними, будучи <em>різними</em> екземплярами одного типу. Для прикладу, якщо ми повернемо назад прізвище у раніше зміненої особи:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="kt">var</span> <span class="n">originalPerson</span> <span class="p">=</span> <span class="n">otherPerson</span> <span class="n">with</span> <span class="p">{</span> <span class="n">LastName</span> <span class="p">=</span> <span class="s">"Hunter"</span> <span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Тепер ми мали б <code class="language-plaintext highlighter-rouge">ReferenceEquals(person, originalPerson)</code> = false (це різні екземпляри), але <code class="language-plaintext highlighter-rouge">Equals(person, originalPerson)</code> = true (вони містять однакові дані).</p>

<p>Якщо вам не підходить порівняння по полях, що визначається початково, ви можете написати своє. Але треба бути обережним і розуміти, як працює порівняння за значеннями в структурах, особливо якщо є наслідування (до якого ми ще повернемося нижче).</p>

<p>Поряд з перевизначенням <code class="language-plaintext highlighter-rouge">Equals</code> перевизначається також <code class="language-plaintext highlighter-rouge">GetHashCode()</code>, бо вони працюють у парі.</p>

<h3 id="поля-класів-даних">Поля класів даних</h3>
<p>Класи даних задумувались незмінюваними і такими, що містять лише публічні властивості з ініціалізаторами. Класи даних можуть змінюватись в не деструктивний спосіб завдяки <code class="language-plaintext highlighter-rouge">with</code>-виразам. Для того, щоб спростити визначення класів даних для цього поширеного випадку, синтаксис класу даних змінює семантику, що несе <code class="language-plaintext highlighter-rouge">string FirstName</code>. Замість неявного приватного поля, як це було б у визначенні класу чи структури, в синтаксисі класу даних це означає публічну автовластивість з ініціалізатором! Таким чином, визначення:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="n">data</span> <span class="k">class</span> <span class="nc">Person</span> <span class="p">{</span> <span class="kt">string</span> <span class="n">FirstName</span><span class="p">;</span> <span class="kt">string</span> <span class="n">LastName</span><span class="p">;</span> <span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>Означає в точності те ж, що ми мали раніше:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="n">data</span> <span class="k">class</span> <span class="nc">Person</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="n">init</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="n">init</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>Ми вважаємо, це дозволяє зробити визначення класу даних чистим і красивим. Якщо вам дійсно потрібне приватне поле, ви завжди можете додати модифікатор <code class="language-plaintext highlighter-rouge">private</code> явно:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">private</span> <span class="kt">string</span> <span class="n">firstName</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="позиційні-класи-даних">Позиційні класи даних</h3>
<p>Інколи зручно використовувати більш позиційний підхід до класів даних, при якому дані передаються через аргументи конструктора і можуть бути отримані назад завдяки позиційному деконструюванню.</p>

<p>Абсолютно допустимим є визначення власного конструктора і деконструктора класу даних:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="n">data</span> <span class="k">class</span> <span class="nc">Person</span> 
<span class="p">{</span> 
    <span class="kt">string</span> <span class="n">FirstName</span><span class="p">;</span> 
    <span class="kt">string</span> <span class="n">LastName</span><span class="p">;</span> 
    <span class="k">public</span> <span class="nf">Person</span><span class="p">(</span><span class="kt">string</span> <span class="n">firstName</span><span class="p">,</span> <span class="kt">string</span> <span class="n">lastName</span><span class="p">)</span> 
      <span class="p">=&gt;</span> <span class="p">(</span><span class="n">FirstName</span><span class="p">,</span> <span class="n">LastName</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="n">firstName</span><span class="p">,</span> <span class="n">lastName</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Deconstruct</span><span class="p">(</span><span class="k">out</span> <span class="kt">string</span> <span class="n">firstName</span><span class="p">,</span> <span class="k">out</span> <span class="kt">string</span> <span class="n">lastName</span><span class="p">)</span> 
      <span class="p">=&gt;</span> <span class="p">(</span><span class="n">firstName</span><span class="p">,</span> <span class="n">lastName</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="n">FirstName</span><span class="p">,</span> <span class="n">LastName</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Але існує набагато коротший синтаксис для вираження того самого (зверніть увагу на регістр імен параметрів):</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="n">data</span> <span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="kt">string</span> <span class="n">FirstName</span><span class="p">,</span> <span class="kt">string</span> <span class="n">LastName</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Цей запис визначає публічні автовластивості і конструктор з деконструктором, тож ви можете написати:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="kt">var</span> <span class="n">person</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Person</span><span class="p">(</span><span class="s">"Scott"</span><span class="p">,</span> <span class="s">"Hunter"</span><span class="p">);</span> <span class="c1">// позиціне конструювання</span>
<span class="kt">var</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="p">=</span> <span class="n">person</span><span class="p">;</span>                        <span class="c1">// позиціне деконструювання</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Якщо вам не подобається згенерована автовластивіть, ви можете натомість визначити свою власну з тим же іменем, і згенеровані конструктор та деконструктор будуть її використовувати.</p>

<h3 id="класи-даних-і-змінюваний-стан">Класи даних і змінюваний стан</h3>

<p>Семантика значення не дуже добре поєднується зі змінюваним станом. Уявіть, ми помістили об’єкт класу даних в словник. Його подальший пошук залежить від <code class="language-plaintext highlighter-rouge">Equals</code> та (інколи) <code class="language-plaintext highlighter-rouge">GethashCode</code>. Але, якщо клас даних змінює свій стан, він також змінює свою еквівалентність! Ми можемо не знайти його знову! В реалізації хеш таблиці це може пошкодити структуру даних, бо розміщення об’єкту грунтується на хеш коді, який він має в момент запису у таблицю.</p>

<p>Напевно, є допустимі приклади використання змінюваного стану класів даних, зокрема для кешування. Але щоб перевизначити поведінку так, щоб ігнорувати цей стан, доведеться докласти <em>значних</em> зусиль.</p>

<h3 id="with-вираз-та-наслідування">With-вираз та наслідування</h3>
<p>Порівняння за значенням та недеструктивна мутація значно ускладнюються, коли поєднуються з наслідуванням. Давайте додамо похідний клас даних <code class="language-plaintext highlighter-rouge">Student</code> до раніше розглянутого прикладу:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="n">data</span> <span class="k">class</span> <span class="nc">Person</span> <span class="p">{</span> <span class="kt">string</span> <span class="n">FirstName</span><span class="p">;</span> <span class="kt">string</span> <span class="n">LastName</span><span class="p">;</span> <span class="p">}</span>
<span class="k">public</span> <span class="n">data</span> <span class="k">class</span> <span class="nc">Student</span> <span class="p">:</span> <span class="n">Person</span> <span class="p">{</span> <span class="kt">int</span> <span class="n">ID</span><span class="p">;</span> <span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Почнемо наш приклад зі створення екземпляру <code class="language-plaintext highlighter-rouge">Student</code>, але збережемо його у змінній типу <code class="language-plaintext highlighter-rouge">Person</code>:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">Person</span> <span class="n">person</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Student</span> <span class="p">{</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"Scott"</span><span class="p">,</span> <span class="n">LastName</span> <span class="p">=</span> <span class="s">"Hunter"</span><span class="p">,</span> <span class="n">ID</span> <span class="p">=</span> <span class="nf">GetNewId</span><span class="p">()</span> <span class="p">};</span>
<span class="n">otherPerson</span> <span class="p">=</span> <span class="n">person</span> <span class="n">with</span> <span class="p">{</span> <span class="n">LastName</span> <span class="p">=</span> <span class="s">"Hanselman"</span> <span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<p>В останньому рядку з <code class="language-plaintext highlighter-rouge">with</code>-виразом компілятор не знає, що <code class="language-plaintext highlighter-rouge">person</code> фактично містить екземпляр <code class="language-plaintext highlighter-rouge">Student</code>. Тим не менш, новий екземпляр <code class="language-plaintext highlighter-rouge">otherPerson</code> не був би коректною копією, якби він <em>не був екземпляром</em> <code class="language-plaintext highlighter-rouge">Student</code> і не містив той самий <code class="language-plaintext highlighter-rouge">ID</code>, що і оригінальний об’єкт.</p>

<p>C# робить це за нас. Класи даних містять прихований віртуальний метод, якому доручено клонування <em>цілого</em> об’єкту. Кожен похідний тип класу даних перевизначає цей метод і викликає конструктор копіювання для цього типу. Цей конструктор викликає аналогічний конструктор базового типу. <code class="language-plaintext highlighter-rouge">With</code>-вираз просто викликає цей прихований метод клонування і застосовує ініціалізатор об’єкту до результату.</p>

<h3 id="порівняння-за-значенням-і-наслідування">Порівняння за значенням і наслідування</h3>
<p>Подібно до реалізації <code class="language-plaintext highlighter-rouge">with</code>-виразів, порівняння за значенням також повинно бути “віртуальним” в тому сенсі, що для порівняння двох екземплярів типу <code class="language-plaintext highlighter-rouge">Student</code> повинні бути порівняні всі поля типу <code class="language-plaintext highlighter-rouge">Student</code>, навіть якщо тип посилання на момент порівняння - це базовий тип, наприклад, <code class="language-plaintext highlighter-rouge">Person</code>. Цього легко досягти, перевизначивши метод <code class="language-plaintext highlighter-rouge">Equals</code>, що наразі вже є віртуальним.</p>

<p>Проте, є ще одна проблема з еквівалентністю. Що, як ви порівнюєте два <em>різних</em> підтипи базового типу <code class="language-plaintext highlighter-rouge">Person</code>? Ми не можемо дозволити вибирати метод <code class="language-plaintext highlighter-rouge">Equal</code> якого типу використовувати: еквівалентність повинна бути симетричною. Тож результат не повинен залежати від порядку об’єктів. Іншими словами, вони повинні самі <em>узгодити</em>, чию еквівалентність застосовувати.</p>

<p>Цей приклад ілюструє проблему:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">Person</span> <span class="n">person1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"Scott"</span><span class="p">,</span> <span class="n">LastName</span> <span class="p">=</span> <span class="s">"Hunter"</span> <span class="p">};</span>
<span class="n">Person</span> <span class="n">person2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Student</span> <span class="p">{</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"Scott"</span><span class="p">,</span> <span class="n">LastName</span> <span class="p">=</span> <span class="s">"Hunter"</span><span class="p">,</span> <span class="n">ID</span> <span class="p">=</span> <span class="nf">GetNewId</span><span class="p">()</span> <span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Чи рівні ці два об’єкти? <code class="language-plaintext highlighter-rouge">person1</code> може думати, що так, адже <code class="language-plaintext highlighter-rouge">person2</code> має всі поля типу <code class="language-plaintext highlighter-rouge">Person</code> з тими ж значеннями. Але <code class="language-plaintext highlighter-rouge">person2</code> з цим не погодиться! Ми повинні бути впевненими, що вони обоє розуміють, що вони все ж різні об’єкти.</p>

<p>І знову, C# подбав про це. Спосіб, в який це реалізовано: класи даних мають віртуальну захищену властивість <code class="language-plaintext highlighter-rouge">EqualityContract</code>. Кожен похідний клас даних перевизначає її і для того, щоб два класи даних були однаковими, вони повинні мати один і той самий <code class="language-plaintext highlighter-rouge">EqualityContract</code>.</p>

<h2 id="програми-найвищого-рівня">Програми найвищого рівня</h2>
<p>Написання простої програми на C# вимагає значної кількості шаблонного коду:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Hello World!"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Це не тільки важко сприймати тим, хто тільки починає вивчати мову, а ще й захаращує код та додає зайві рівні відступів.</p>

<p>Натомість, в C# 9.0 ви можете просто писати вашу програму на найвищому рівні:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Hello World!"</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Будь-які вирази дозволені. Програма може початися відразу після списку <code class="language-plaintext highlighter-rouge">using</code> і перед визначенням будь якого типу чи простору імен. Але ви можете так робити тільки в одному файлі, точно так як зараз ви можете мати лише один метод <code class="language-plaintext highlighter-rouge">Main</code>.</p>

<p>Якщо ви хочете повернути код статусу, ви можете це зробити. Якщо ви хочете очікувати задачу з <code class="language-plaintext highlighter-rouge">await</code>, ви можете це зробити. І якщо ви хочете отримати доступ до аргументів командного рядку, вони доступні як “магічний” параметр <code class="language-plaintext highlighter-rouge">args</code>.</p>

<p>Локальні функції - це також вирази і вони так само дозволені на найвищому рівні. Але, у разі виклику їх поза областю програми найвищого рівня, буде згенеровано помилку.</p>

<h2 id="вдосконалене-співставлення-за-шаблоном">Вдосконалене співставлення за шаблоном</h2>
<p>Декілька нових типів шаблонів порівняння були додані в C# 9.0. Давайте подивимось на них в контексті цього фрагменту коду з <a href="https://docs.microsoft.com/en-us/dotnet/csharp/tutorials/pattern-matching">навчального посібника</a>:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">static</span> <span class="kt">decimal</span> <span class="nf">CalculateToll</span><span class="p">(</span><span class="kt">object</span> <span class="n">vehicle</span><span class="p">)</span> <span class="p">=&gt;</span>
    <span class="n">vehicle</span> <span class="k">switch</span>
    <span class="p">{</span>
       <span class="p">...</span>
       
        <span class="n">DeliveryTruck</span> <span class="n">t</span> <span class="n">when</span> <span class="n">t</span><span class="p">.</span><span class="n">GrossWeightClass</span> <span class="p">&gt;</span> <span class="m">5000</span> <span class="p">=&gt;</span> <span class="m">10.00</span><span class="n">m</span> <span class="p">+</span> <span class="m">5.00</span><span class="n">m</span><span class="p">,</span>
        <span class="n">DeliveryTruck</span> <span class="n">t</span> <span class="n">when</span> <span class="n">t</span><span class="p">.</span><span class="n">GrossWeightClass</span> <span class="p">&lt;</span> <span class="m">3000</span> <span class="p">=&gt;</span> <span class="m">10.00</span><span class="n">m</span> <span class="p">-</span> <span class="m">2.00</span><span class="n">m</span><span class="p">,</span>
        <span class="n">DeliveryTruck</span> <span class="n">_</span> <span class="p">=&gt;</span> <span class="m">10.00</span><span class="n">m</span><span class="p">,</span>

        <span class="n">_</span> <span class="p">=&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">"Not a known vehicle type"</span><span class="p">,</span> <span class="k">nameof</span><span class="p">(</span><span class="n">vehicle</span><span class="p">))</span>
    <span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="спрощений-шаблон-типу">Спрощений шаблон типу</h3>
<p>Наразі, шаблон типу вимагає визначення змінної, навіть якщо ця змінна ігнорується, як у випадку з <code class="language-plaintext highlighter-rouge">_</code>. У прикладі вище це <code class="language-plaintext highlighter-rouge">DeliveryTruck _</code>. Але тепер ви можете просто написати тип:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">DeliveryTruck</span> <span class="p">=&gt;</span> <span class="m">10.00</span><span class="n">m</span><span class="p">,</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="шаблони-порівняння">Шаблони порівняння</h3>
<p>C# 9.0 вводить шаблони на основі операторів порівняння <code class="language-plaintext highlighter-rouge">&lt;</code>, <code class="language-plaintext highlighter-rouge">&lt;=</code> і т.ін. Тож тепер ви можете написати чатину з <code class="language-plaintext highlighter-rouge">DeliveryTruck</code> з наведеного вище шаблону як вкладений switch вираз:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="n">DeliveryTruck</span> <span class="n">t</span> <span class="n">when</span> <span class="n">t</span><span class="p">.</span><span class="n">GrossWeightClass</span> <span class="k">switch</span>
<span class="p">{</span>
    <span class="p">&gt;</span> <span class="m">5000</span> <span class="p">=&gt;</span> <span class="m">10.00</span><span class="n">m</span> <span class="p">+</span> <span class="m">5.00</span><span class="n">m</span><span class="p">,</span>
    <span class="p">&lt;</span> <span class="m">3000</span> <span class="p">=&gt;</span> <span class="m">10.00</span><span class="n">m</span> <span class="p">-</span> <span class="m">2.00</span><span class="n">m</span><span class="p">,</span>
    <span class="n">_</span> <span class="p">=&gt;</span> <span class="m">10.00</span><span class="n">m</span><span class="p">,</span>
<span class="p">},</span>
</pre></td></tr></tbody></table></code></div></div>
<p>Тут <code class="language-plaintext highlighter-rouge">&gt; 5000</code> і <code class="language-plaintext highlighter-rouge">&lt; 3000</code> - це шаблони порівняння.</p>

<h3 id="логічні-шаблони">Логічні шаблони</h3>
<p>Нарешті ви можете поєднувати шаблони з логічними операторами <code class="language-plaintext highlighter-rouge">and</code>, <code class="language-plaintext highlighter-rouge">or</code> і <code class="language-plaintext highlighter-rouge">not</code>. Вони записані словами, щоб уникнути плутанини з операторами у виразах. Для прикладу, випадок з вкладеним switch виразом вище можна переписати розташувавши діапазони по зростанню, як наведено нижче:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="n">DeliveryTruck</span> <span class="n">t</span> <span class="n">when</span> <span class="n">t</span><span class="p">.</span><span class="n">GrossWeightClass</span> <span class="k">switch</span>
<span class="p">{</span>
    <span class="p">&lt;</span> <span class="m">3000</span> <span class="p">=&gt;</span> <span class="m">10.00</span><span class="n">m</span> <span class="p">-</span> <span class="m">2.00</span><span class="n">m</span><span class="p">,</span>
    <span class="p">&gt;=</span> <span class="m">3000</span> <span class="n">and</span> <span class="p">&lt;=</span> <span class="m">5000</span> <span class="p">=&gt;</span> <span class="m">10.00</span><span class="n">m</span><span class="p">,</span>
    <span class="p">&gt;</span> <span class="m">5000</span> <span class="p">=&gt;</span> <span class="m">10.00</span><span class="n">m</span> <span class="p">+</span> <span class="m">5.00</span><span class="n">m</span><span class="p">,</span>
<span class="p">},</span>
</pre></td></tr></tbody></table></code></div></div>
<p>Середній вираз тут використовує <code class="language-plaintext highlighter-rouge">and</code>, щоб поєднати два шаблони порівняння в єдиний шаблон, що відображує діапазон.</p>

<p>Шаблон <code class="language-plaintext highlighter-rouge">not</code> може використовуватись спільно з констатним шаблоном <code class="language-plaintext highlighter-rouge">null</code>, як <code class="language-plaintext highlighter-rouge">not null</code>. Для прикладу, ми можемо розділити обробку невідомого випадку в залежності від того, чи дорівнює він <code class="language-plaintext highlighter-rouge">null</code>:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">not</span> <span class="k">null</span> <span class="p">=&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">$"Not a known vehicle type: </span><span class="p">{</span><span class="n">vehicle</span><span class="p">}</span><span class="s">"</span><span class="p">,</span> <span class="k">nameof</span><span class="p">(</span><span class="n">vehicle</span><span class="p">)),</span>
<span class="k">null</span> <span class="p">=&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentNullException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">vehicle</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></div></div>
<p>Також <code class="language-plaintext highlighter-rouge">not</code> може бути корисним з оператором if, умова якого містить вираз <code class="language-plaintext highlighter-rouge">is</code> замість потворних подвійних дужок:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(!(</span><span class="n">e</span> <span class="k">is</span> <span class="n">Customer</span><span class="p">))</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Ви можете просто написати</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="k">is</span> <span class="n">not</span> <span class="n">Customer</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="вдосконалене-приведення-до-цільового-типу">Вдосконалене приведення до цільового типу</h2>

<p>“Приведенням до цільового типу” ми називаємо ситуацію, коли вираз отримує свій тип з контексту, в якому він використовується. Для прикладу <code class="language-plaintext highlighter-rouge">null</code> чи лямбда-вирази завжди використовують приведення до цільового типу.</p>

<p>В C# 9.0 деякі вирази, які до цього не використовували приведення до цільового типу, отримали можливість визначати тип з контексту.</p>

<h3 id="приведення-у-виразі-new">Приведення у виразі <code class="language-plaintext highlighter-rouge">new</code></h3>
<p>Вираз <code class="language-plaintext highlighter-rouge">new</code> у C# завжди вимагав вказування типу (за винятком неявно типізованих масивів). Тепер ви можете пропустити тип, якщо змінна, якій присвоюється вираз, вже його має.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">Point</span> <span class="n">p</span> <span class="p">=</span> <span class="k">new</span> <span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">5</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="приведення-у-виразах--та-">Приведення у виразах <code class="language-plaintext highlighter-rouge">??</code> та <code class="language-plaintext highlighter-rouge">?:</code></h3>
<p>Інколи умовні вирази <code class="language-plaintext highlighter-rouge">??</code> та <code class="language-plaintext highlighter-rouge">?:</code> не мають явного спільного типу між різними гілками виконання. Такі випадки зараз не компілюються, але C# 9.0 буде дозволяти їх, якщо існує цільовий тип, до якого обидва результати можуть бути приведені.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">Person</span> <span class="n">person</span> <span class="p">=</span> <span class="n">student</span> <span class="p">??</span> <span class="n">customer</span><span class="p">;</span> <span class="c1">// спільний базовий тип</span>
<span class="kt">int</span><span class="p">?</span> <span class="n">result</span> <span class="p">=</span> <span class="n">b</span> <span class="p">?</span> <span class="m">0</span> <span class="p">:</span> <span class="k">null</span><span class="p">;</span> <span class="c1">// значений nullable тип</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="коваріантні-результати">Коваріантні результати</h2>

<p>Інколи корисно якось виразити те, що перевизначений метод похідного класу повертає більш конкретний тип, ніж визначено у базовому класі. C# 9.0 дозволяє таке:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="k">abstract</span> <span class="k">class</span> <span class="nc">Animal</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="n">Food</span> <span class="nf">GetFood</span><span class="p">();</span>
    <span class="p">...</span>
<span class="p">}</span>
<span class="k">class</span> <span class="nc">Tiger</span> <span class="p">:</span> <span class="n">Animal</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">override</span> <span class="n">Meat</span> <span class="nf">GetFood</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="p">...;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="і-навіть-більше">І навіть більше…</h2>

<p>Найкраще місце, щоб ознайомитися з повним переліком майбутніх можливостей в C# 9.0 і слідкувати за їх реалізацією - це сторінка <a href="https://github.com/dotnet/roslyn/blob/master/docs/Language%20Feature%20Status.md">Статус реалізації нових можливостей мови</a> в репозиторії Roslyn (C#/VB Compiler) на GitHub.</p>

<p>Приємного кодування!</p>


      </div>

      <div class="post-tail-wrapper text-muted">

        <!-- categories -->
        
        <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
          
            <a href='/uk/categories/%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D1%83%D0%B2%D0%B0%D0%BD%D0%BD%D1%8F/'>Програмування</a>,
            <a href='/uk/categories/net/'>.NET</a>
        </div>
        

        <!-- tags -->
        

        <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
          

          

        </div><!-- .post-tail-bottom -->

      </div><!-- div.post-tail -->

    </div> <!-- .post -->


  </div> <!-- #post-wrapper -->

  

  

  <!--
  The Pannel on right side (Desktop views)
-->

<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

  <div class="access">

  















  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  

  
    <div id="access-tags">
      <span>Популярні Теги</span>
      <div class="d-flex flex-wrap mt-3 mb-1 mr-3">        
      
        
        <a class="post-tag" href="/uk/tags/net/">.NET</a>
      
        
        <a class="post-tag" href="/uk/tags/c/">C#</a>
      
        
        <a class="post-tag" href="/uk/tags/asp-net-core/">ASP.NET Core</a>
      
        
        <a class="post-tag" href="/uk/tags/heroku/">Heroku</a>
      
        
        <a class="post-tag" href="/uk/tags/%D0%BF%D0%B5%D1%80%D0%B5%D0%BA%D0%BB%D0%B0%D0%B4/">переклад</a>
      
        
        <a class="post-tag" href="/uk/tags/acid/">ACID</a>
      
        
        <a class="post-tag" href="/uk/tags/aws/">AWS</a>
      
        
        <a class="post-tag" href="/uk/tags/codility-com/">codility.com</a>
      
        
        <a class="post-tag" href="/uk/tags/dynamodb/">DynamoDB</a>
      
        
        <a class="post-tag" href="/uk/tags/entity-framework/">Entity Framework</a>
      

      </div>
    </div>
  
  </div> <!-- .access -->

  
    <!-- BS-toc.js will be loaded at medium priority -->
    <script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>
    <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
      <span class="pl-3 pt-2 mb-2">Contents</span>
      <nav id="toc" data-toggle="toc"></nav>
    </div>
  

</div> <!-- #panel-wrapper -->


</div> <!-- .row -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

          

    

    
      <!--
  The Disqus lazy loading.
  Powered by: <https://github.com/osvaldasvalutis/disqusLoader.js>
-->

<div id="disqus" class="pt-2 pb-2">
  <p class="text-center text-muted small pb-5">
    Loading comments from <a href="https://disqus.com/">Disqus</a> ...
  </p>
</div>

<script src="/assets/js/lib/jquery.disqusloader.min.js"></script>
<script>
  const options = {
    scriptUrl: '//martyniuk.disqus.com/embed.js',

    disqusConfig: function() {
      this.page.title = '';
      this.page.url = 'http://0.0.0.0:4000/uk/posts/%D0%B7%D1%83%D1%81%D1%82%D1%80%D1%96%D1%87%D0%B0%D0%B9%D1%82%D0%B5-csharp-9/';
      this.page.identifier = '/posts/%D0%B7%D1%83%D1%81%D1%82%D1%80%D1%96%D1%87%D0%B0%D0%B9%D1%82%D0%B5-csharp-9/';
    }
  };

  $.disqusLoader('#disqus', options);
</script>

    

    </div> <!-- #post-extend-wrapper -->

  </div> <!-- .col-* -->

</div> <!-- .row -->



  <!--
  image lazy load: https://github.com/ApoorvSaxena/lozad.js
-->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script>

<script type="text/javascript">
  const imgs = document.querySelectorAll('.post-content img');
  const observer = lozad(imgs);
  observer.observe();
</script>




        <!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center">
    

    <div class="footer-left">

    </div>

    <div class="footer-right">
      <p class="mb-0">
        Powered by
        <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
        with
        <a href="https://github.com/cotes2020/jekyll-theme-chirpy"
          target="_blank" rel="noopener">Chirpy</a>
        theme.
      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      <h4 class="text-muted mb-4">Trending Tags</h4>

      















  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



      
        
        <a class="post-tag" href="/tags/net/">.NET</a>
      
        
        <a class="post-tag" href="/tags/c/">C#</a>
      
        
        <a class="post-tag" href="/uk/tags/asp-net-core/">ASP.NET Core</a>
      
        
        <a class="post-tag" href="/uk/tags/heroku/">Heroku</a>
      
        
        <a class="post-tag" href="/uk/tags/%D0%BF%D0%B5%D1%80%D0%B5%D0%BA%D0%BB%D0%B0%D0%B4/">переклад</a>
      
        
        <a class="post-tag" href="/tags/acid/">ACID</a>
      
        
        <a class="post-tag" href="/tags/aws/">AWS</a>
      
        
        <a class="post-tag" href="/tags/codility-com/">codility.com</a>
      
        
        <a class="post-tag" href="/tags/dynamodb/">DynamoDB</a>
      
        
        <a class="post-tag" href="/uk/tags/entity-framework/">Entity Framework</a>
      

    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="http://0.0.0.0:4000{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


  </body>

</html>

