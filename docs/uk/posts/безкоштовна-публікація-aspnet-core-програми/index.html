<!DOCTYPE html>



<html lang="uk" 
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  
    <meta name="pv-cache-enabled" content="false">

    
  

  <title>
      Безкоштовна публікація ASP.NET Core програми | 
    Мартинюк Олександр
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://www.favicon-generator.org/
-->



<link rel="shortcut icon" href="/uk/assets/img/favicons/favicon.ico" type="image/x-icon">
<link rel="icon" href="/uk/assets/img/favicons/favicon.ico" type="image/x-icon">

<link rel="apple-touch-icon" href="/uk/assets/img/favicons/apple-icon.png">
<link rel="apple-touch-icon" href="/uk/assets/img/favicons/apple-icon-precomposed.png">
<link rel="apple-touch-icon" sizes="57x57" href="/uk/assets/img/favicons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/uk/assets/img/favicons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/uk/assets/img/favicons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/uk/assets/img/favicons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/uk/assets/img/favicons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/uk/assets/img/favicons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/uk/assets/img/favicons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/uk/assets/img/favicons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/uk/assets/img/favicons/apple-icon-180x180.png">

<link rel="icon" type="image/png" sizes="192x192"  href="/uk/assets/img/favicons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/uk/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/uk/assets/img/favicons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/uk/assets/img/favicons/favicon-16x16.png">

<link rel="manifest" href="/uk/assets/img/favicons/manifest.json">
<meta name='msapplication-config' content='/uk/assets/img/favicons/browserconfig.xml'>
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/uk/assets/img/favicons/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous">

  <!-- Font Awesome -->
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"
    integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ="
    crossorigin="anonymous">

  <!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css">


  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">



  <!-- JavaScripts -->

  <script src="/assets/js/dist/lang-detector.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  <script defer
    src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>

  <!--
  JS selector for site.
-->


  





<script defer src="/assets/js/dist/post.min.js"></script>






</head>


  <body data-spy="scroll" data-target="#toc">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">

  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        
        <img src="/assets/img/sample/avatar.jpg" alt="avatar" onerror="this.style.display='none'">
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">Мартинюк Олександр</a>
    </div>

    <div class="site-subtitle font-italic">Програміст .NET</div>

    <!-- language -->

    
    
    <div class="site-title mt-0">               
      
        <a href="/posts/%D0%B1%D0%B5%D0%B7%D0%BA%D0%BE%D1%88%D1%82%D0%BE%D0%B2%D0%BD%D0%B0-%D0%BF%D1%83%D0%B1%D0%BB%D1%96%D0%BA%D0%B0%D1%86%D1%96%D1%8F-aspnet-core-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%B8/" title="In English">
          <img src="/assets/img/sample/english.png" width="40px" height="40px"/>          
        </a>  
                    
    </div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">    
    <!-- home -->
    
    <li class="nav-item">
      <a href="/uk/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>СТАТТІ</span>
      </a>
    </li>
    <!-- the real tabs -->
    

      

      <li class="nav-item">
        <a href="/uk/categories/" class="nav-link">
          <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
          <span>КАТЕГОРІЇ</span>
        </a>
      </li> <!-- .nav-item -->
    

      

      <li class="nav-item">
        <a href="/uk/tags/" class="nav-link">
          <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i>
          <span>ТЕГИ</span>
        </a>
      </li> <!-- .nav-item -->
    

      

      <li class="nav-item">
        <a href="/uk/archives/" class="nav-link">
          <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
          <span>АРХІВ</span>
        </a>
      </li> <!-- .nav-item -->
    

      

      <li class="nav-item">
        <a href="/uk/projects/" class="nav-link">
          <i class="fa-fw fas fa-tasks ml-xl-3 mr-xl-3 unloaded"></i>
          <span>ПРОЄКТИ</span>
        </a>
      </li> <!-- .nav-item -->
    

      

      <li class="nav-item">
        <a href="/uk/about/" class="nav-link">
          <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i>
          <span>ПРО МЕНЕ</span>
        </a>
      </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">

    
      

      
      <a href="https://github.com/alexmartyniuk" aria-label="github"
        class="order-3"
        target="_blank" rel="noopener">
        <i class="fab fa-github-alt"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/alexmartyniuk" aria-label="twitter"
        class="order-4"
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['alexander.martinyuk','gmail.com'].join('@')" aria-label="email"
        class="order-5"
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        class="order-6"
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

    
      
        <span class="icon-border order-2"></span>
      

      <span id="mode-toggle-wrapper" class="order-1">
        <!--
  Switch the mode between dark and light.
-->

<i class="mode-toggle fas fa-adjust"></i>

<script type="text/javascript">

  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      var self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addListener(function() {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }

          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.updateMermaid();
      });

    } /* constructor() */


    setDark() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_KEY);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; }

    get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer) ) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    updateMermaid() {
      if (typeof mermaid !== "undefined") {
        let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default");
        let config = { theme: expectedTheme };

        /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */
        $(".mermaid").each(function() {
          let svgCode = $(this).prev().children().html();
          $(this).removeAttr("data-processed");
          $(this).html(svgCode);
        });

        mermaid.initialize(config);
        mermaid.init(undefined, ".mermaid");
      }
    }

    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }

        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }

      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.updateMermaid();

    } /* flipMode() */

  } /* ModeToggle */

  let toggle = new ModeToggle();

  $(".mode-toggle").click(function() {

    toggle.flipMode();

  });

</script>

      </span>
    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">

    

    

      

        
          

        

      

        
        <span>
          
          
          <a href="/">
            Posts
          </a>
        </span>

        

      

        
          <span></span>

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->


<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->


<!-- Add attribute 'hide-bullet' to the checkbox list -->




  

  

  <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->
  
  

  

  



<!-- return -->
<div class="row">

  <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">

    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

      <h1 data-toc-skip>Безкоштовна публікація ASP.NET Core програми</h1>

      <div class="post-meta text-muted d-flex flex-column">
        <!-- Published date and author -->
        <div>
          <!--
  Date format snippet
-->





<span class="timeago "
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Thu, May 21, 2020, 11:00 AM +0300"
  >

  
  

  
    May 21, 2020
  

  <i class="unloaded">2020-05-21T11:00:00+03:00</i>

</span>
          
        </div>

        <div>       
          <!-- read time -->
          <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->


<!-- words per minute  -->







<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1408 words">7 min</span>


          <!-- page views -->
          

        </div>

      </div> <!-- .post-meta -->

      <div class="post-content">

        

        <p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="http://www.martyniuk.info/assets/img/posts/2020-05-21-deploy-dotnet-core-app-for-free/cover.png" alt="" /></p>

<p>В багатьох програмістів є власні проєкти на .NET Core, які в певний момент хочеться показати іншим. Бажано, щоб розгортання відбувалось просто і швидко, а хостинг був безкоштовним. В цій статті я розкажу, як розгортати проєкти на .NET Core в Heroku з безперервною доставкою, не вкладаючи в це ні копійки.</p>

<h2 id="передумови">Передумови</h2>
<p>Для роботи нам потрібні будуть <strong>.NET Core SDK</strong> (у мене встановлено версію 3.1), <strong>Git</strong> для роботи з репозиторієм та <strong>Heroku CLI</strong> для роботи з Heroku. Сподіваюсь, ви вже маєте <a href="https://dotnet.microsoft.com/download">.NET Core</a> та <a href="https://git-scm.com/">Git</a>. Як встановити Heroku CLI я розкажу далі.</p>

<h2 id="heroku-та-безкоштовний-dyno">Heroku та безкоштовний dyno</h2>

<p><strong><a href="http://heroku.com">Heroku</a></strong> - хмарний провайдер, що дозволяє запускати веб програми і сервіси написані на мовах Java, Node.JS, Scala, Python, PHP, Ruby, Go та Clojure. Heroku була однією з перших хмарних платформ. В її основі лежить система віртуалізації побудована на ізольованих Linux контейнерах, які в Heroku називаються <strong>dyno</strong>. Тобто, dyno - це ніби окремий віртуальний комп’ютер, що виконує вашу програму на серверах Heroku.</p>

<p>Безкоштовно Heroku надає один dyno з наступними характеристиками:</p>
<ul>
  <li>512 MB оперативної пам’яті</li>
  <li>550 годин виконання кожного місяця</li>
</ul>

<p>Dyno бувають двох типів:</p>
<ul>
  <li><strong>web</strong> - для програм що очікують вхідних HTTP запитів</li>
  <li><strong>worker</strong> - для програм, що виконують операції у фоні</li>
</ul>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="http://www.martyniuk.info/assets/img/posts/2020-05-21-deploy-dotnet-core-app-for-free/free-plan-capabilities.png" alt="" /></p>

<p>Якщо ви використовуєте лише безкоштовний dyno, варто зауважити, що Heroku призупиняє виконання dyno після 30 хв бездіяльності. Тобто, якщо за останні 30 хв. до вашого web dyno не надійшло жодного запиту, він буде поставлений на паузу. Прокинеться він при наступному запиті. Для користувача це може виглядадти так, ніби сайт в браузері перший раз відкривається довго. В той час, поки ваш dyno спить, він НЕ споживає вільні години. Іншими словами, якщо ваш тестовий проєкт досить навантажений і обслуговує користувачів 24 години на добу вам вистачить вільних хвилин лише на 23 дні в місяць.</p>

<blockquote>
  <p>Heroku дає можливість розширити кількість вільних хвилин до 1000 просто вказавши реквізити банківської карти в налаштуваннях, без жодних списань коштів. Це дає можливість працювати одному free dyno без зупинки 24/7 або двом-трьом free dyno, якщо навантаження на сайт не постійне.</p>
</blockquote>

<h2 id="налаштування-heroku-cli">Налаштування Heroku CLI</h2>

<p>Давайте створимо безкоштовний акаунт <a href="https://signup.heroku.com/">Heroku</a> і розгорнемо в ньому просту ASP.NET Core програму. Після реєстрації і підтвердження поштової адреси завантажте <a href="https://devcenter.heroku.com/articles/heroku-cli#download-and-install">Heroku CLI</a>. Це консольна утиліта, що спростить створення і розгортання веб програми без відвідування сайту. Далі ми будемо все робити через командний рядок, тому важливо, щоб вона була встановлена.</p>

<p>Перевірте, чи ви маєте все необхідне для роботи. Версії програм можуть відрізнятись, це не принципово. Головне, що .NET, Git and Heroku CLI встановлені коректно.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="o">&gt;</span> dotnet <span class="nt">--version</span>
3.1.300-preview-015115

<span class="o">&gt;</span> git <span class="nt">--version</span>
git version 2.24.1.windows.

<span class="o">&gt;</span> heroku <span class="nt">--version</span>
heroku/7.30.0 win32-x64 node-v11.14.0
</pre></td></tr></tbody></table></code></div></div>

<h2 id="створення-програми-aspnet-core">Створення програми ASP.NET Core</h2>
<p>Створимо ASP.NET Core веб програму в каталозі <code class="language-plaintext highlighter-rouge">dotnet-app-heroku</code>.</p>

<blockquote>
  <p>Вам не варто використовувати ту саму назву для програми. Змініть її на щось унікальне, наприклад <code class="language-plaintext highlighter-rouge">%USERNAME%-dotnet-app-heroku</code>. Це дасть змогу уникнути конфліктів адрес з моєю програмою, яка може бути в цей момент розгорнута в Інтернет.</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="o">&gt;</span> dotnet new webapp <span class="nt">--name</span> DotnetAppHeroku <span class="nt">--output</span> dotnet-app-heroku       
The template <span class="s2">"ASP.NET Core Web App"</span> was created successfully.
...
Restore succeeded.
</pre></td></tr></tbody></table></code></div></div>

<p>Тепер створимо програму в Heroku, але перед цим необхідно пройти процедуру логіну.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="o">&gt;</span> <span class="nb">cd </span>dotnet-app-heroku

<span class="o">&gt;</span> heroku login   
heroku: Press any key to open up the browser to login or q to <span class="nb">exit</span>:
Opening browser to https://cli-auth.heroku.com/auth/cli/browser/12b5558d-f062-4dbb-a055-1c7e9f0f84c5
Logging <span class="k">in</span>... <span class="k">done
</span>Logged <span class="k">in </span>as elexander+heroku@ukr.net

<span class="o">&gt;</span> heroku create dotnet-app-heroku
Creating ⬢ dotnet-app-heroku... <span class="k">done
</span>https://dotnet-app-heroku.herokuapp.com/ | https://git.heroku.com/dotnet-app-heroku.git

</pre></td></tr></tbody></table></code></div></div>
<p>В результаті команди <code class="language-plaintext highlighter-rouge">create</code> ми отримали дві URL адреси, що знадобляться нам пізніше. Перша - це адреса нашого майбутнього сайту в Інтернет, а друга - адреса Git репозиторію, в який нам необхідно проштовхнути наш код, щоб розгорнути веб програму.</p>

<p>Створимо git репозиторій в каталозі проєкту, додамо всі файли і спробуємо проштовхнути код у репозиторій.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="o">&gt;</span> git init
Initialized empty Git repository <span class="k">in</span> ./dotnet-app-heroku/.git/

<span class="o">&gt;</span> git remote add origin https://git.heroku.com/dotnet-app-heroku.git

<span class="o">&gt;</span> git add <span class="nb">.</span>

<span class="o">&gt;</span> git commit <span class="nt">--message</span> <span class="s2">"Initial add"</span>      
<span class="o">[</span>master <span class="o">(</span>root-commit<span class="o">)</span> f471c3c] Initial add
 57 files changed, 39806 insertions<span class="o">(</span>+<span class="o">)</span>
 create mode 100644 DotnetAppHeroku.csproj
 create mode 100644 Pages/Error.cshtml
 ...

 <span class="o">&gt;</span> git push origin master
 Enumerating objects: 76, <span class="k">done</span><span class="nb">.</span>
...
Total 76 <span class="o">(</span>delta 12<span class="o">)</span>, reused 0 <span class="o">(</span>delta 0<span class="o">)</span>
remote: Compressing <span class="nb">source </span>files... <span class="k">done</span><span class="nb">.</span>
remote: Building <span class="nb">source</span>:
remote:
remote:  <span class="o">!</span>     No default language could be detected <span class="k">for </span>this app.
remote:  HINT: This occurs when Heroku cannot detect the buildpack to use <span class="k">for </span>this application 
</pre></td></tr></tbody></table></code></div></div>

<p>Команда <code class="language-plaintext highlighter-rouge">git push</code> звершилась з помилкою <code class="language-plaintext highlighter-rouge">No default language could be detected for this app</code>. Причина в тому, що Heroku не підтримує .NET проєкти, тобто не знає, як зкомпілювати та запустити ASP.NET веб програму. Давайте допоможемо йому.</p>

<h2 id="контейнер-в-якості-стеку">Контейнер в якості стеку</h2>

<p>Всі dyno за умовчанням запускаються на Linux Ubuntu 18:
<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="http://www.martyniuk.info/assets/img/posts/2020-05-21-deploy-dotnet-core-app-for-free/dotnet-app-heroku-settings.png" alt="" /></p>

<p>Але Heroku має можливість запустити будь-який <strong>Docker</strong> контейнер і таким чином дозволяє самостійно вирішувати, яка операційна система і фреймворк потрібні програмісту.</p>

<p>Для цього нам необхідно:</p>
<ol>
  <li>Змінити стек програми на <code class="language-plaintext highlighter-rouge">container</code></li>
  <li>Створити <code class="language-plaintext highlighter-rouge">Dockerfile</code></li>
  <li>Вказати Heroku де цей <code class="language-plaintext highlighter-rouge">Dockerfile</code> знаходиться</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="o">&gt;</span> heroku stack:set container
Stack set. Next release on ⬢ dotnet-app-heroku will use container.
Run git push heroku master to create a new release on ⬢ dotnet-app-heroku.
</pre></td></tr></tbody></table></code></div></div>
<p>Тепер dyno буде використовувати для запуску контейнер, який ми зараз побудуємо. Створіть файл <code class="language-plaintext highlighter-rouge">Dockerfile</code> в каталозі проєкту з таким вмістом.</p>

<div class="language-docker highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> mcr.microsoft.com/dotnet/core/sdk:3.1 AS build-env</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> *.csproj ./</span>
<span class="k">RUN </span>dotnet restore
<span class="k">COPY</span><span class="s"> . ./</span>
<span class="k">RUN </span>dotnet publish <span class="nt">-c</span> Release <span class="nt">-o</span> out

<span class="k">FROM</span><span class="s"> mcr.microsoft.com/dotnet/core/aspnet:3.1</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> --from=build-env /app/out .</span>

<span class="k">CMD</span><span class="s"> dotnet DotnetAppHeroku.dll</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Ми не будемо зупинятись на детальному розборі даного файлу. Якщо коротко, то він компілює проєкт з релізною конфігурацією і запускає його на виконання командою <code class="language-plaintext highlighter-rouge">dotnet DotnetAppHeroku.dll</code>.</p>

<blockquote>
  <p>Якщо ім’я вашого проєкту відрізняється від DotnetAppHeroku вам необхідно змінити останній рядоку файлу.</p>
</blockquote>

<p>Також необхідно створити в корні проєкту файл <code class="language-plaintext highlighter-rouge">heroku.yml</code>, де вказати шлях до <code class="language-plaintext highlighter-rouge">Dockerfile</code>, який Heroku буде використовувати для побудови образу.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="na">build</span><span class="pi">:</span>
  <span class="na">docker</span><span class="pi">:</span>
    <span class="na">web</span><span class="pi">:</span> <span class="s">Dockerfile</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Тепер можна додати новостворені файли до репозиторію і знову зробити push.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="o">&gt;</span> git add <span class="nb">.</span>  

<span class="o">&gt;</span> git status                              
On branch master
Changes to be committed:
  <span class="o">(</span>use <span class="s2">"git restore --staged &lt;file&gt;..."</span> to unstage<span class="o">)</span>        
        new file:   Dockerfile
        new file:   heroku.yml

<span class="o">&gt;</span> git commit <span class="nt">--message</span> <span class="s2">"Added Dockerfile"</span> 
<span class="o">[</span>master 1f184b8] Added Dockerfile
 2 files changed, 15 insertions<span class="o">(</span>+<span class="o">)</span>
 create mode 100644 Dockerfile
 create mode 100644 heroku.yml

<span class="o">&gt;</span> git push origin master
Enumerating objects: 80, <span class="k">done</span><span class="nb">.</span>
...
remote: <span class="o">===</span> Building web <span class="o">(</span>Dockerfile<span class="o">)</span>
remote: Sending build context to Docker daemon  4.404MB    
...
remote: Verifying deploy... <span class="k">done</span><span class="nb">.</span>
To https://git.heroku.com/dotnet-app-heroku.git
 <span class="k">*</span> <span class="o">[</span>new branch]      master -&gt; master
</pre></td></tr></tbody></table></code></div></div>

<h2 id="змінна-оточення-port">Змінна оточення PORT</h2>

<p>Якщо зараз відкрити сайт <code class="language-plaintext highlighter-rouge">https://dotnet-app-heroku.herokuapp.com/</code> в браузері ми побачимо помилку.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="http://www.martyniuk.info/assets/img/posts/2020-05-21-deploy-dotnet-core-app-for-free/app-error.png" alt="" /></p>

<p>Щоб розібратись, чому це сталося, переглянемо логи нашої програми:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="o">&gt;</span> heroku logs
...
app[web.1]: Unhandled exception. System.Net.Sockets.SocketException <span class="o">(</span>13<span class="o">)</span>: Permission denied
...
app[web.1]: at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketTransportFactory.BindAsync<span class="o">(</span>EndPoint endpoint, CancellationToken cancellationToken<span class="o">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Як бачимо, сталася помилка <code class="language-plaintext highlighter-rouge">Permission denied</code> під час відкриття порту на прослуховування. Механізми безпеки Linux працюють таким чином, що для прослуховування стандартного для <strong>HTTP</strong> порту <strong>80</strong> процесу необхідні права супер-користувача. В <a href="https://devcenter.heroku.com/articles/setting-the-http-port-for-java-applications">документації</a> до Heroku можна знайти вирішення проблеми. Heroku очікує, що кожна програма буде стартувати не з довільним портом, а з портом заданим у змінній оточення <strong>PORT</strong>. Внутрішні механізми Heroku будуть відправляти на цей порт весь трафік із зовнішнього порту 80, на якому сайт буде доступний в Інтернет.</p>

<p>Виправимо це в нашому проєкті і додамо відповідну конфігурацію для Kestrel серверу у файлі <code class="language-plaintext highlighter-rouge">Startup.cs</code>:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="n">webBuilder</span>
    <span class="p">.</span><span class="n">UseStartup</span><span class="p">&lt;</span><span class="n">Startup</span><span class="p">&gt;()</span>
    <span class="p">.</span><span class="nf">UseKestrel</span><span class="p">((</span><span class="n">context</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">port</span> <span class="p">=</span> <span class="n">Environment</span><span class="p">.</span><span class="nf">GetEnvironmentVariable</span><span class="p">(</span><span class="s">"PORT"</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">options</span><span class="p">.</span><span class="nf">ListenAnyIP</span><span class="p">(</span><span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">port</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Тепер можна зберегти зміни і зробити пуш в репозиторій. Пуш займе близько хвилини, поки створиться Docker образ. Відкрийте <code class="language-plaintext highlighter-rouge">https://dotnet-app-heroku.herokuapp.com/</code>. Тепер все працює.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="http://www.martyniuk.info/assets/img/posts/2020-05-21-deploy-dotnet-core-app-for-free/app-running.png" alt="" /></p>

<h2 id="висновок">Висновок</h2>
<p>Ми побачили, як:</p>
<ol>
  <li>Створити безкоштовний акаунт в Heroku та інсталювати Heroku CLI.</li>
  <li>Створити проєкт ASP.NET Core та додати Dockerfile для компіляції проєкту в образ.</li>
  <li>Розгорнути образ в Heroku завдяки команді <code class="language-plaintext highlighter-rouge">git push</code>.</li>
  <li>Переглянути логи програми у разі помилки.</li>
  <li>Використовувати змінні оточення Heroku для успішного старту програми.</li>
</ol>

<p><a href="https://github.com/alexmartyniuk/blog-dotnet-app-heroku">Репозиторій на Github</a></p>

<h2 id="наступні-кроки">Наступні кроки</h2>
<p>В наступних дописах я планую розглянути використання аддонів Heroku, які дають можливість підключати сервіси бази даних, кешування, логування, повнотекстового пошуку і багато чого іншого. Вони також мають безкоштовні версії, яких може бути цілком достатньо для вашого PET-проєкту.</p>

<p>Також може бути цікавою документація по <a href="https://devcenter.heroku.com/articles/heroku-cli-commands">Heroku CLI</a>, яка дозволяє моніторити виконання ваших програм, переглядати кількість використаних годин, додавати інших співробітників до вашого проєкту і т.ін.</p>


      </div>

      <div class="post-tail-wrapper text-muted">

        <!-- categories -->
        
        <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
          
            <a href='/uk/categories/%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D1%83%D0%B2%D0%B0%D0%BD%D0%BD%D1%8F/'>Програмування</a>,
            <a href='/uk/categories/net/'>.NET</a>
        </div>
        

        <!-- tags -->
        

        <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
          

          

        </div><!-- .post-tail-bottom -->

      </div><!-- div.post-tail -->

    </div> <!-- .post -->


  </div> <!-- #post-wrapper -->

  

  

  <!--
  The Pannel on right side (Desktop views)
-->

<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

  <div class="access">

  















  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  

  
    <div id="access-tags">
      <span>Популярні Теги</span>
      <div class="d-flex flex-wrap mt-3 mb-1 mr-3">        
      
        
        <a class="post-tag" href="/uk/tags/net/">.NET</a>
      
        
        <a class="post-tag" href="/uk/tags/c/">C#</a>
      
        
        <a class="post-tag" href="/uk/tags/asp-net-core/">ASP.NET Core</a>
      
        
        <a class="post-tag" href="/uk/tags/heroku/">Heroku</a>
      
        
        <a class="post-tag" href="/uk/tags/%D0%BF%D0%B5%D1%80%D0%B5%D0%BA%D0%BB%D0%B0%D0%B4/">переклад</a>
      
        
        <a class="post-tag" href="/uk/tags/acid/">ACID</a>
      
        
        <a class="post-tag" href="/uk/tags/aws/">AWS</a>
      
        
        <a class="post-tag" href="/uk/tags/codility-com/">codility.com</a>
      
        
        <a class="post-tag" href="/uk/tags/dynamodb/">DynamoDB</a>
      
        
        <a class="post-tag" href="/uk/tags/entity-framework/">Entity Framework</a>
      

      </div>
    </div>
  
  </div> <!-- .access -->

  
    <!-- BS-toc.js will be loaded at medium priority -->
    <script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>
    <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
      <span class="pl-3 pt-2 mb-2">Contents</span>
      <nav id="toc" data-toggle="toc"></nav>
    </div>
  

</div> <!-- #panel-wrapper -->


</div> <!-- .row -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

          

    

    
      <!--
  The Disqus lazy loading.
  Powered by: <https://github.com/osvaldasvalutis/disqusLoader.js>
-->

<div id="disqus" class="pt-2 pb-2">
  <p class="text-center text-muted small pb-5">
    Loading comments from <a href="https://disqus.com/">Disqus</a> ...
  </p>
</div>

<script src="/assets/js/lib/jquery.disqusloader.min.js"></script>
<script>
  const options = {
    scriptUrl: '//martyniuk.disqus.com/embed.js',

    disqusConfig: function() {
      this.page.title = '';
      this.page.url = 'http://0.0.0.0:4000/uk/posts/%D0%B1%D0%B5%D0%B7%D0%BA%D0%BE%D1%88%D1%82%D0%BE%D0%B2%D0%BD%D0%B0-%D0%BF%D1%83%D0%B1%D0%BB%D1%96%D0%BA%D0%B0%D1%86%D1%96%D1%8F-aspnet-core-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%B8/';
      this.page.identifier = '/posts/%D0%B1%D0%B5%D0%B7%D0%BA%D0%BE%D1%88%D1%82%D0%BE%D0%B2%D0%BD%D0%B0-%D0%BF%D1%83%D0%B1%D0%BB%D1%96%D0%BA%D0%B0%D1%86%D1%96%D1%8F-aspnet-core-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%B8/';
    }
  };

  $.disqusLoader('#disqus', options);
</script>

    

    </div> <!-- #post-extend-wrapper -->

  </div> <!-- .col-* -->

</div> <!-- .row -->



  <!--
  image lazy load: https://github.com/ApoorvSaxena/lozad.js
-->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script>

<script type="text/javascript">
  const imgs = document.querySelectorAll('.post-content img');
  const observer = lozad(imgs);
  observer.observe();
</script>




        <!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center">
    

    <div class="footer-left">

    </div>

    <div class="footer-right">
      <p class="mb-0">
        Powered by
        <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
        with
        <a href="https://github.com/cotes2020/jekyll-theme-chirpy"
          target="_blank" rel="noopener">Chirpy</a>
        theme.
      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      <h4 class="text-muted mb-4">Trending Tags</h4>

      















  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



      
        
        <a class="post-tag" href="/tags/net/">.NET</a>
      
        
        <a class="post-tag" href="/tags/c/">C#</a>
      
        
        <a class="post-tag" href="/uk/tags/asp-net-core/">ASP.NET Core</a>
      
        
        <a class="post-tag" href="/uk/tags/heroku/">Heroku</a>
      
        
        <a class="post-tag" href="/uk/tags/%D0%BF%D0%B5%D1%80%D0%B5%D0%BA%D0%BB%D0%B0%D0%B4/">переклад</a>
      
        
        <a class="post-tag" href="/tags/acid/">ACID</a>
      
        
        <a class="post-tag" href="/tags/aws/">AWS</a>
      
        
        <a class="post-tag" href="/tags/codility-com/">codility.com</a>
      
        
        <a class="post-tag" href="/tags/dynamodb/">DynamoDB</a>
      
        
        <a class="post-tag" href="/uk/tags/entity-framework/">Entity Framework</a>
      

    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="http://0.0.0.0:4000{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


  </body>

</html>

